(function(a){var b=a(document).data("func",{});a.smartMenu=a.noop;a.fn.smartMenu=function(d,i){var f=a("body"),g={name:"",offsetX:2,offsetY:2,textLimit:6,beforeShow:a.noop,afterShow:a.noop};var h=a.extend(g,i||{});var c=function(l){var o=l||d,k=l?Math.random().toString():h.name,j="",m="",n="smart_menu_";if(a.isArray(o)&&o.length){j='<div id="smartMenu_'+k+'" class="'+n+'box"><div class="'+n+'body"><ul class="'+n+'ul">';a.each(o,function(q,p){if(q){j=j+'<li class="'+n+'li_separate">&nbsp;</li>'}if(a.isArray(p)){a.each(p,function(v,u){var x=u.text,r="",t="",s=Math.random().toString().replace(".","");if(x){if(x.length>h.textLimit){x=x.slice(0,h.textLimit)+"â€¦";t=' title="'+u.text+'"'}if(a.isArray(u.data)&&u.data.length){r='<li class="'+n+'li" data-hover="true">'+c(u.data)+'<a href="javascript:" class="'+n+'a"'+t+' data-key="'+s+'"><i class="'+n+'triangle"></i>'+x+"</a></li>"}else{r='<li class="'+n+'li"><a href="javascript:" class="'+n+'a"'+t+' data-key="'+s+'">'+x+"</a></li>"}j+=r;var w=b.data("func");w[s]=u.func;b.data("func",w)}})}});j=j+"</ul></div></div>"}return j},e=function(){var j="#smartMenu_",l="smart_menu_",k=a(j+h.name);if(!k.size()){a("body").append(c());a(j+h.name+" a").bind("click",function(){var m=a(this).attr("data-key"),n=b.data("func")[m];if(a.isFunction(n)){n.call(b.data("trigger"))}a.smartMenu.hide();return false});a(j+h.name+" li").each(function(){var m=a(this).attr("data-hover"),n=l+"li_hover";a(this).hover(function(){var o=a(this).siblings("."+n);o.removeClass(n).children("."+l+"box").hide();o.children("."+l+"a").removeClass(l+"a_hover");if(m){a(this).addClass(n).children("."+l+"box").show();a(this).children("."+l+"a").addClass(l+"a_hover")}})});return a(j+h.name)}return k};a(this).each(function(){this.oncontextmenu=function(l){if(a.isFunction(h.beforeShow)){h.beforeShow.call(this)}l=l||window.event;l.cancelBubble=true;if(l.stopPropagation){l.stopPropagation()}a.smartMenu.hide();var k=b.scrollTop();var j=e();if(j){j.css({display:"block",left:l.clientX+h.offsetX,top:l.clientY+k+h.offsetY});b.data("target",j);b.data("trigger",this);if(a.isFunction(h.afterShow)){h.afterShow.call(this)}return false}}});if(!f.data("bind")){f.bind("click",a.smartMenu.hide).data("bind",true)}};a.extend(a.smartMenu,{hide:function(){var c=b.data("target");if(c&&c.css("display")==="block"){c.hide()}},remove:function(){var c=b.data("target");if(c){c.remove()}}})})(jQuery);