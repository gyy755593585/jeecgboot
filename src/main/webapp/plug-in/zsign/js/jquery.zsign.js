$.fn.zSign=function(h){var m=$.extend({img:"",width:120,height:120,offset:8,callBack:null},h||{});var k=$(this).addClass("zsign");var i={minX:m.offset,minY:m.offset,maxX:k.width()-m.width-m.offset-18,maxY:k.height()-m.height-m.offset-18};var n=$("<div class='panel'><button class='btn add' >盖 章</button><button class='btn cancel'>关 闭</button></div>").appendTo(k);var j="<div class='sign' style='height:"+m.height+"px;width:"+m.width+"px;top:"+m.offset+"px;left:"+m.offset+"px'><img src='"+m.img+"' draggable='false'/><button class='btn ok' >确定</button><button class='btn del' >删除</button></div>";var l=$(".add",n).click(function(a){l.attr("disabled","disabled");var b=$(j).appendTo(k);$(".ok",b).click(function(){b.addClass("ok").off("mousedown").find(".btn").remove();l.removeAttr("disabled");if(m.callBack){m.callBack.call(this,{img:m.img,top:parseInt(b.css("top")),left:parseInt(b.css("left"))})}});$(".del",b).click(function(){b.remove();l.removeAttr("disabled")});b.on("mousedown",function(c){b.data("x",c.clientX);b.data("y",c.clientY);var d=b.position();$(document).on("mousemove",function(f){var g=f.clientX-b.data("x")+d.left;var e=f.clientY-b.data("y")+d.top;g=g<i.minX?i.minX:g;g=g>i.maxX?i.maxX:g;e=e<i.minY?i.minY:e;e=e>i.maxY?i.maxY:e;b.css({left:g,top:e})}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})})});$(".cancel",n).click(function(){var a=true;if(l.attr("disabled")=="disabled"){if(!confirm("未确定的盖章将被取消，确定要关闭吗？")){a=false}}if(a){$(".sign:not(.ok)",k).remove();n.remove()}})};