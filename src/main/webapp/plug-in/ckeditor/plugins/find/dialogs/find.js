(function(){function k(a){return a.type==CKEDITOR.NODE_TEXT&&0<a.getLength()&&(!m||!a.isReadOnly())}function h(a){return !(a.type==CKEDITOR.NODE_ELEMENT&&a.isBlockBoundary(CKEDITOR.tools.extend({},CKEDITOR.dtd.$empty,CKEDITOR.dtd.$nonEditable)))}var m,i=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):null,hitMatchBoundary:this._.matchBoundary}},j=["find","replace"],n=[["txtFindFind","txtFindReplace"],["txtFindCaseChk","txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"]],l=function(w,d){function f(s,o){var p=w.createRange();p.setStart(s.textNode,o?s.offset:s.offset+1);p.setEndAt(w.editable(),CKEDITOR.POSITION_BEFORE_END);return p}function g(s){var o=w.getSelection(),p=w.editable();o&&!s?(s=o.getRanges()[0].clone(),s.collapse(!0)):(s=w.createRange(),s.setStartAt(p,CKEDITOR.POSITION_AFTER_START));s.setEndAt(p,CKEDITOR.POSITION_BEFORE_END);return s}var c=new CKEDITOR.style(CKEDITOR.tools.extend({attributes:{"data-cke-highlight":1},fullMatch:1,ignoreReadonly:1,childRule:function(){return 0}},w.config.find_highlight,!0)),e=function(t,o){var s=this,p=new CKEDITOR.dom.walker(t);p.guard=o?h:function(u){!h(u)&&(s._.matchBoundary=!0)};p.evaluator=k;p.breakOnFalse=1;t.startContainer.type==CKEDITOR.NODE_TEXT&&(this.textNode=t.startContainer,this.offset=t.startOffset-1);this._={matchWord:o,walker:p,matchBoundary:!1}};e.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},move:function(p){var o=this.textNode;if(null===o){return i.call(this)}this._.matchBoundary=!1;if(o&&p&&0<this.offset){this.offset--}else{if(o&&this.offset<o.getLength()-1){this.offset++}else{for(o=null;!o&&!(o=this._.walker[p?"previous":"next"].call(this._.walker),this._.matchWord&&!o||this._.walker._.end);){}this.offset=(this.textNode=o)?p?o.getLength()-1:0:0}}return i.call(this)}};var q=function(p,o){this._={walker:p,cursors:[],rangeLength:o,highlightRange:null,isMatched:0}};q.prototype={toDomRange:function(){var s=w.createRange(),o=this._.cursors;if(1>o.length){var p=this._.walker.textNode;if(p){s.setStartAfter(p)}else{return null}}else{p=o[0],o=o[o.length-1],s.setStart(p.textNode,p.offset),s.setEnd(o.textNode,o.offset+1)}return s},updateFromDomRange:function(p){var o=new e(p);this._.cursors=[];do{p=o.next(),p.character&&this._.cursors.push(p)}while(p.character);this._.rangeLength=this._.cursors.length},setMatched:function(){this._.isMatched=!0},clearMatched:function(){this._.isMatched=!1},isMatched:function(){return this._.isMatched},highlight:function(){if(!(1>this._.cursors.length)){this._.highlightRange&&this.removeHighlight();var p=this.toDomRange(),o=p.createBookmark();c.applyToRange(p);p.moveToBookmark(o);this._.highlightRange=p;o=p.startContainer;o.type!=CKEDITOR.NODE_ELEMENT&&(o=o.getParent());o.scrollIntoView();this.updateFromDomRange(p)}},removeHighlight:function(){if(this._.highlightRange){var o=this._.highlightRange.createBookmark();c.removeFromRange(this._.highlightRange);this._.highlightRange.moveToBookmark(o);this.updateFromDomRange(this._.highlightRange);this._.highlightRange=null}},isReadOnly:function(){return !this._.highlightRange?0:this._.highlightRange.startContainer.isReadOnly()},moveBack:function(){var p=this._.walker.back(),o=this._.cursors;p.hitMatchBoundary&&(this._.cursors=o=[]);o.unshift(p);o.length>this._.rangeLength&&o.pop();return p},moveNext:function(){var p=this._.walker.next(),o=this._.cursors;p.hitMatchBoundary&&(this._.cursors=o=[]);o.push(p);o.length>this._.rangeLength&&o.shift();return p},getEndCharacter:function(){var o=this._.cursors;return 1>o.length?null:o[o.length-1].character},getNextCharacterRange:function(s){var o,p;p=this._.cursors;p=(o=p[p.length-1])&&o.textNode?new e(f(o)):this._.walker;return new q(p,s)},getCursors:function(){return this._.cursors}};var r=function(t,o){var s=[-1];o&&(t=t.toLowerCase());for(var p=0;p<t.length;p++){for(s.push(s[p]+1);0<s[p+1]&&t.charAt(p)!=t.charAt(s[p+1]-1);){s[p+1]=s[s[p+1]-1]+1}}this._={overlap:s,state:0,ignoreCase:!!o,pattern:t}};r.prototype={feedCharacter:function(o){for(this._.ignoreCase&&(o=o.toLowerCase());;){if(o==this._.pattern.charAt(this._.state)){return this._.state++,this._.state==this._.pattern.length?(this._.state=0,2):1}if(this._.state){this._.state=this._.overlap[this._.state]}else{return 0}}return null},reset:function(){this._.state=0}};var x=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,v=function(p){if(!p){return !0}var o=p.charCodeAt(0);return 9<=o&&13>=o||8192<=o&&8202>=o||x.test(p)},a={searchRange:null,matchRange:null,find:function(F,G,p,t,J,I){this.matchRange?(this.matchRange.removeHighlight(),this.matchRange=this.matchRange.getNextCharacterRange(F.length)):this.matchRange=new q(new e(this.searchRange),F.length);for(var A=new r(F,!G),o=0,y="%";null!==y;){for(this.matchRange.moveNext();y=this.matchRange.getEndCharacter();){o=A.feedCharacter(y);if(2==o){break}this.matchRange.moveNext().hitMatchBoundary&&A.reset()}if(2==o){if(p){var u=this.matchRange.getCursors(),H=u[u.length-1],u=u[0],s=w.createRange();s.setStartAt(w.editable(),CKEDITOR.POSITION_AFTER_START);s.setEnd(u.textNode,u.offset);u=s;H=f(H);u.trim();H.trim();u=new e(u,!0);H=new e(H,!0);if(!v(u.back().character)||!v(H.next().character)){continue}}this.matchRange.setMatched();!1!==J&&this.matchRange.highlight();return !0}}this.matchRange.clearMatched();this.matchRange.removeHighlight();return t&&!I?(this.searchRange=g(1),this.matchRange=null,arguments.callee.apply(this,Array.prototype.slice.call(arguments).concat([!0]))):!1},replaceCounter:0,replace:function(y,B,o,t,s,u,A){m=1;y=0;if(this.matchRange&&this.matchRange.isMatched()&&!this.matchRange._.isReplaced&&!this.matchRange.isReadOnly()){this.matchRange.removeHighlight();B=this.matchRange.toDomRange();o=w.document.createText(o);if(!A){var p=w.getSelection();p.selectRanges([B]);w.fire("saveSnapshot")}B.deleteContents();B.insertNode(o);A||(p.selectRanges([B]),w.fire("saveSnapshot"));this.matchRange.updateFromDomRange(B);A||this.matchRange.highlight();this.matchRange._.isReplaced=!0;this.replaceCounter++;y=1}else{y=this.find(B,t,s,u,!A)}m=0;return y}},b=w.lang.find;return{title:b.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:350,minHeight:170,buttons:[CKEDITOR.dialog.cancelButton(w,{label:w.lang.common.close})],contents:[{id:"find",label:b.find,title:b.find,accessKey:"",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindFind",label:b.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFind",align:"left",style:"width:100%",label:b.find,onClick:function(){var o=this.getDialog();a.find(o.getValueOf("find","txtFindFind"),o.getValueOf("find","txtFindCaseChk"),o.getValueOf("find","txtFindWordChk"),o.getValueOf("find","txtFindCyclic"))||alert(b.notFoundMsg)}}]},{type:"fieldset",label:CKEDITOR.tools.htmlEncode(b.findOptions),style:"margin-top:29px",children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtFindCaseChk",isChanged:!1,label:b.matchCase},{type:"checkbox",id:"txtFindWordChk",isChanged:!1,label:b.matchWord},{type:"checkbox",id:"txtFindCyclic",isChanged:!1,"default":!0,label:b.matchCyclic}]}]}]},{id:"replace",label:b.replace,accessKey:"M",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindReplace",label:b.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFindReplace",align:"left",style:"width:100%",label:b.replace,onClick:function(){var o=this.getDialog();a.replace(o,o.getValueOf("replace","txtFindReplace"),o.getValueOf("replace","txtReplace"),o.getValueOf("replace","txtReplaceCaseChk"),o.getValueOf("replace","txtReplaceWordChk"),o.getValueOf("replace","txtReplaceCyclic"))||alert(b.notFoundMsg)}}]},{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtReplace",label:b.replaceWith,isChanged:!1,labelLayout:"horizontal",accessKey:"R"},{type:"button",id:"btnReplaceAll",align:"left",style:"width:100%",label:b.replaceAll,isChanged:!1,onClick:function(){var o=this.getDialog();a.replaceCounter=0;a.searchRange=g(1);a.matchRange&&(a.matchRange.removeHighlight(),a.matchRange=null);for(w.fire("saveSnapshot");a.replace(o,o.getValueOf("replace","txtFindReplace"),o.getValueOf("replace","txtReplace"),o.getValueOf("replace","txtReplaceCaseChk"),o.getValueOf("replace","txtReplaceWordChk"),!1,!0);){}a.replaceCounter?(alert(b.replaceSuccessMsg.replace(/%1/,a.replaceCounter)),w.fire("saveSnapshot")):alert(b.notFoundMsg)}}]},{type:"fieldset",label:CKEDITOR.tools.htmlEncode(b.findOptions),children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtReplaceCaseChk",isChanged:!1,label:b.matchCase},{type:"checkbox",id:"txtReplaceWordChk",isChanged:!1,label:b.matchWord},{type:"checkbox",id:"txtReplaceCyclic",isChanged:!1,"default":!0,label:b.matchCyclic}]}]}]}],onLoad:function(){var s=this,o,p=0;this.on("hide",function(){p=0});this.on("show",function(){p=1});this.selectPage=CKEDITOR.tools.override(this.selectPage,function(t){return function(E){t.call(s,E);var F=s._.tabs[E],A;A="find"===E?"txtFindWordChk":"txtReplaceWordChk";o=s.getContentElement(E,"find"===E?"txtFindFind":"txtFindReplace");s.getContentElement(E,A);F.initialized||(CKEDITOR.document.getById(o._.inputId),F.initialized=!0);if(p){var y,E="find"===E?1:0,F=1-E,D,u=n.length;for(D=0;D<u;D++){A=this.getContentElement(j[E],n[D][E]),y=this.getContentElement(j[F],n[D][F]),y.setValue(A.getValue())}}}})},onShow:function(){a.searchRange=g();var p=this.getParentEditor().getSelection().getSelectedText(),o=this.getContentElement(d,"find"==d?"txtFindFind":"txtFindReplace");o.setValue(p);o.select();this.selectPage(d);this[("find"==d&&this._.editor.readOnly?"hide":"show")+"Page"]("replace")},onHide:function(){var o;a.matchRange&&a.matchRange.isMatched()&&(a.matchRange.removeHighlight(),w.focus(),(o=a.matchRange.toDomRange())&&w.getSelection().selectRanges([o]));delete a.matchRange},onFocus:function(){return"replace"==d?this.getContentElement("replace","txtFindReplace"):this.getContentElement("find","txtFindFind")}}};CKEDITOR.dialog.add("find",function(a){return l(a,"find")});CKEDITOR.dialog.add("replace",function(a){return l(a,"replace")})})();