CKEDITOR.dialog.add("specialchar",function(i){var e,l=i.lang.specialchar,k=function(a){var b,a=a.data?a.data.getTarget():new CKEDITOR.dom.element(a);if("a"==a.getName()&&(b=a.getChild(0).getHtml())){a.removeClass("cke_light_background"),e.hide(),a=i.document.createElement("span"),a.setHtml(b),i.insertText(a.getText())}},m=CKEDITOR.tools.addFunction(k),j,g=function(c,b){var a,b=b||c.data.getTarget();"span"==b.getName()&&(b=b.getParent());if("a"==b.getName()&&(a=b.getChild(0).getHtml())){j&&d(null,j);var f=e.getContentElement("info","htmlPreview").getElement();e.getContentElement("info","charPreview").getElement().setHtml(a);f.setHtml(CKEDITOR.tools.htmlEncode(a));b.getParent().addClass("cke_light_background");j=b}},d=function(a,b){b=b||a.data.getTarget();"span"==b.getName()&&(b=b.getParent());"a"==b.getName()&&(e.getContentElement("info","charPreview").getElement().setHtml("&nbsp;"),e.getContentElement("info","htmlPreview").getElement().setHtml("&nbsp;"),b.getParent().removeClass("cke_light_background"),j=void 0)},n=CKEDITOR.tools.addFunction(function(c){var c=new CKEDITOR.dom.event(c),b=c.getTarget(),a;a=c.getKeystroke();var f="rtl"==i.lang.dir;switch(a){case 38:if(a=b.getParent().getParent().getPrevious()){a=a.getChild([b.getParent().getIndex(),0]),a.focus(),d(null,b),g(null,a)}c.preventDefault();break;case 40:if(a=b.getParent().getParent().getNext()){if((a=a.getChild([b.getParent().getIndex(),0]))&&1==a.type){a.focus(),d(null,b),g(null,a)}}c.preventDefault();break;case 32:k({data:c});c.preventDefault();break;case f?37:39:if(a=b.getParent().getNext()){a=a.getChild(0),1==a.type?(a.focus(),d(null,b),g(null,a),c.preventDefault(!0)):d(null,b)}else{if(a=b.getParent().getParent().getNext()){(a=a.getChild([0,0]))&&1==a.type?(a.focus(),d(null,b),g(null,a),c.preventDefault(!0)):d(null,b)}}break;case f?39:37:(a=b.getParent().getPrevious())?(a=a.getChild(0),a.focus(),d(null,b),g(null,a),c.preventDefault(!0)):(a=b.getParent().getParent().getPrevious())?(a=a.getLast().getChild(0),a.focus(),d(null,b),g(null,a),c.preventDefault(!0)):d(null,b)}});return{title:l.title,minWidth:430,minHeight:280,buttons:[CKEDITOR.dialog.cancelButton],charColumns:17,onLoad:function(){for(var p=this.definition.charColumns,o=i.config.specialChars,h=CKEDITOR.tools.getNextId()+"_specialchar_table_label",b=['<table role="listbox" aria-labelledby="'+h+'" style="width: 320px; height: 100%; border-collapse: separate;" align="center" cellspacing="2" cellpadding="2" border="0">'],q=0,t=o.length,a,r;q<t;){b.push('<tr role="presentation">');for(var c=0;c<p;c++,q++){if(a=o[q]){a instanceof Array?(r=a[1],a=a[0]):(r=a.replace("&","").replace(";","").replace("#",""),r=l[r]||a);var f="cke_specialchar_label_"+q+"_"+CKEDITOR.tools.getNextNumber();b.push('<td class="cke_dark_background" style="cursor: default" role="presentation"><a href="javascript: void(0);" role="option" aria-posinset="'+(q+1)+'"',' aria-setsize="'+t+'"',' aria-labelledby="'+f+'"',' class="cke_specialchar" title="',CKEDITOR.tools.htmlEncode(r),'" onkeydown="CKEDITOR.tools.callFunction( '+n+', event, this )" onclick="CKEDITOR.tools.callFunction('+m+', this); return false;" tabindex="-1"><span style="margin: 0 auto;cursor: inherit">'+a+'</span><span class="cke_voice_label" id="'+f+'">'+r+"</span></a>")}else{b.push('<td class="cke_dark_background">&nbsp;')}b.push("</td>")}b.push("</tr>")}b.push("</tbody></table>",'<span id="'+h+'" class="cke_voice_label">'+l.options+"</span>");this.getContentElement("info","charContainer").getElement().setHtml(b.join(""))},contents:[{id:"info",label:i.lang.common.generalTab,title:i.lang.common.generalTab,padding:0,align:"top",elements:[{type:"hbox",align:"top",widths:["320px","90px"],children:[{type:"html",id:"charContainer",html:"",onMouseover:g,onMouseout:d,focus:function(){var a=this.getElement().getElementsByTag("a").getItem(0);setTimeout(function(){a.focus();g(null,a)},0)},onShow:function(){var a=this.getElement().getChild([0,0,0,0,0]);setTimeout(function(){a.focus();g(null,a)},0)},onLoad:function(a){e=a.sender}},{type:"hbox",align:"top",widths:["100%"],children:[{type:"vbox",align:"top",children:[{type:"html",html:"<div></div>"},{type:"html",id:"charPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:28px;height:40px;width:70px;padding-top:9px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"},{type:"html",id:"htmlPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:14px;height:20px;width:70px;padding-top:2px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"}]}]}]}]}]}});