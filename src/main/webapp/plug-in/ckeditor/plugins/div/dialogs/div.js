(function(){function d(b,a,f){if(!a.is||!a.getCustomData("block_processed")){a.is&&CKEDITOR.dom.element.setMarker(f,a,"block_processed",!0),b.push(a)}}function c(m,a){function k(){this.foreach(function(e){if(/^(?!vbox|hbox)/.test(e.type)&&(e.setup||(e.setup=function(f){e.setValue(f.getAttribute(e.id)||"",1)}),!e.commit)){e.commit=function(f){var g=this.getValue();"dir"==e.id&&f.getComputedStyle("direction")==g||(g?f.setAttribute(e.id,g):f.removeAttribute(e.id))}}})}var n=function(){var e=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);m.config.div_wrapTable&&(delete e.td,delete e.th);return e}(),j=CKEDITOR.dtd.div,b={},l=[];return{title:m.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:m.lang.common.generalTab,title:m.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:m.lang.div.styleSelectLabel,"default":"",items:[[m.lang.common.notSet,""]],onChange:function(){var e=["info:elementStyle","info:class","advanced:dir","advanced:style"],i=this.getDialog(),f=i._element&&i._element.clone()||new CKEDITOR.dom.element("div",m.document);this.commit(f,!0);for(var e=[].concat(e),h=e.length,g,p=0;p<h;p++){(g=i.getContentElement.apply(i,e[p].split(":")))&&g.setup&&g.setup(f,!0)}},setup:function(f){for(var e in b){b[e].checkElementRemovable(f,!0)&&this.setValue(e,1)}},commit:function(f){var e;(e=this.getValue())?b[e].applyToObject(f):f.removeAttribute("style")}},{id:"class",type:"text",requiredContent:"div(cke-xyz)",label:m.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:m.lang.common.advancedTab,title:m.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",requiredContent:"div[id]",label:m.lang.common.id,"default":""},{type:"text",id:"lang",requiredContent:"div[lang]",label:m.lang.common.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",requiredContent:"div{cke-xyz}",style:"width: 100%;",label:m.lang.common.cssStyle,"default":"",commit:function(e){e.setAttribute("style",this.getValue())}}]},{type:"hbox",children:[{type:"text",id:"title",requiredContent:"div[title]",style:"width: 100%;",label:m.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",requiredContent:"div[dir]",style:"width: 100%;",label:m.lang.common.langDir,"default":"",items:[[m.lang.common.notSet,""],[m.lang.common.langDirLtr,"ltr"],[m.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){k.call(this);var f=this,e=this.getContentElement("info","elementStyle");m.getStylesSet(function(i){var g,p;if(i){for(var h=0;h<i.length;h++){p=i[h],p.element&&"div"==p.element&&(g=p.name,b[g]=p=new CKEDITOR.style(p),m.filter.check(p)&&(e.items.push([g,g]),e.add(g,g)))}}e[1<e.items.length?"enable":"disable"]();setTimeout(function(){f._element&&e.setup(f._element)},0)})},onShow:function(){"editdiv"==a&&this.setupContent(this._element=CKEDITOR.plugins.div.getSurroundDiv(m))},onOk:function(){if("editdiv"==a){l=[this._element]}else{var x=[],w={},h=[],v,i=m.getSelection(),e=i.getRanges(),u=i.createBookmarks(),g,t;for(g=0;g<e.length;g++){for(t=e[g].createIterator();v=t.getNextParagraph();){if(v.getName() in n){var f=v.getChildren();for(v=0;v<f.count();v++){d(h,f.getItem(v),w)}}else{for(;!j[v.getName()]&&!v.equals(e[g].root);){v=v.getParent()}d(h,v,w)}}}CKEDITOR.dom.element.clearAllMarkers(w);e=[];g=null;for(t=0;t<h.length;t++){v=h[t],f=m.elementPath(v).blockLimit,m.config.div_wrapTable&&f.is(["td","th"])&&(f=m.elementPath(f.getParent()).blockLimit),f.equals(g)||(g=f,e.push([])),e[e.length-1].push(v)}for(g=0;g<e.length;g++){f=e[g][0];h=f.getParent();for(v=1;v<e[g].length;v++){h=h.getCommonAncestor(e[g][v])}t=new CKEDITOR.dom.element("div",m.document);for(v=0;v<e[g].length;v++){for(f=e[g][v];!f.getParent().equals(h);){f=f.getParent()}e[g][v]=f}for(v=0;v<e[g].length;v++){if(f=e[g][v],!f.getCustomData||!f.getCustomData("block_processed")){f.is&&CKEDITOR.dom.element.setMarker(w,f,"block_processed",!0),v||t.insertBefore(f),t.append(f)}}CKEDITOR.dom.element.clearAllMarkers(w);x.push(t)}i.selectBookmarks(u);l=x}x=l.length;for(w=0;w<x;w++){this.commitContent(l[w]),!l[w].getAttribute("style")&&l[w].removeAttribute("style")}this.hide()},onHide:function(){"editdiv"==a&&this._element.removeCustomData("elementStyle");delete this._element}}}CKEDITOR.dialog.add("creatediv",function(a){return c(a,"creatediv")});CKEDITOR.dialog.add("editdiv",function(a){return c(a,"editdiv")})})();