(function(){CKEDITOR.dialog.add("templates",function(f){function i(a,b){var e=CKEDITOR.dom.element.createFromHtml('<a href="javascript:void(0)" tabIndex="-1" role="option" ><div class="cke_tpl_item"></div></a>'),d='<table style="width:350px;" class="cke_tpl_preview" role="presentation"><tr>';a.image&&b&&(d+='<td class="cke_tpl_preview_img"><img src="'+CKEDITOR.getUrl(b+a.image)+'"'+(CKEDITOR.env.ie6Compat?' onload="this.width=this.width"':"")+' alt="" title=""></td>');d+='<td style="white-space:normal;"><span class="cke_tpl_title">'+a.title+"</span><br/>";a.description&&(d+="<span>"+a.description+"</span>");e.getFirst().setHtml(d+"</td></tr></table>");e.on("click",function(){o(a.html)});return e}function o(a){var b=CKEDITOR.dialog.getCurrent();b.getValueOf("selectTpl","chkInsertOpt")?(f.fire("saveSnapshot"),f.setData(a,function(){b.hide();var d=f.createRange();d.moveToElementEditStart(f.editable());d.select();setTimeout(function(){f.fire("saveSnapshot")},0)})):(f.insertHtml(a),b.hide())}function p(j){var k=j.data.getTarget(),a=g.equals(k);if(a||g.contains(k)){var b=j.data.getKeystroke(),e=g.getElementsByTag("a"),d;if(e){if(a){d=e.getItem(0)}else{switch(b){case 40:d=k.getNext();break;case 38:d=k.getPrevious();break;case 13:case 32:k.fire("click")}}d&&(d.focus(),j.data.preventDefault())}}}var h=CKEDITOR.plugins.get("templates");CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(h.path+"dialogs/templates.css"));var g,h="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber(),c=f.lang.templates,l=f.config;return{title:f.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:c.title,elements:[{type:"vbox",padding:5,children:[{id:"selectTplText",type:"html",html:"<span>"+c.selectPromptMsg+"</span>"},{id:"templatesList",type:"html",focus:!0,html:'<div class="cke_tpl_list" tabIndex="-1" role="listbox" aria-labelledby="'+h+'"><div class="cke_tpl_loading"><span></span></div></div><span class="cke_voice_label" id="'+h+'">'+c.options+"</span>"},{id:"chkInsertOpt",type:"checkbox",label:c.insertOption,"default":l.templates_replaceContent}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var a=this.getContentElement("selectTpl","templatesList");g=a.getElement();CKEDITOR.loadTemplates(l.templates_files,function(){var t=(l.templates||"default").split(",");if(t.length){var b=g;b.setHtml("");for(var d=0,j=t.length;d<j;d++){for(var e=CKEDITOR.getTemplates(t[d]),k=e.imagesPath,e=e.templates,s=e.length,m=0;m<s;m++){var n=i(e[m],k);n.setAttribute("aria-posinset",m+1);n.setAttribute("aria-setsize",s);b.append(n)}}a.focus()}else{g.setHtml('<div class="cke_tpl_empty"><span>'+c.emptyListMsg+"</span></div>")}});this._.element.on("keydown",p)},onHide:function(){this._.element.removeListener("keydown",p)}}})})();